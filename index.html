<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ADD Companion">
  <meta name="theme-color" content="#1f2937">
  <title>ADD Companion</title>
  
  <!-- PWA Manifest inline as data URI -->
  <link rel="manifest" href="data:application/json,{
    &quot;name&quot;: &quot;ADD Companion&quot;,
    &quot;short_name&quot;: &quot;ADD&quot;,
    &quot;start_url&quot;: &quot;.&quot;,
    &quot;display&quot;: &quot;standalone&quot;,
    &quot;background_color&quot;: &quot;%23f9fafb&quot;,
    &quot;theme_color&quot;: &quot;%231f2937&quot;,
    &quot;icons&quot;: []
  }">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f9fafb;
      min-height: 100vh;
      min-height: 100dvh;
      color: #1f2937;
      line-height: 1.5;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      padding-bottom: 2rem;
    }
    
    /* Header */
    .header {
      position: sticky;
      top: 0;
      background: white;
      border-bottom: 1px solid #f3f4f6;
      z-index: 10;
      display: none;
    }
    
    .header.visible { display: block; }
    
    .header-inner {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 1.25rem;
    }
    
    .back-btn {
      background: none;
      border: none;
      padding: 0.5rem;
      margin: -0.5rem;
      margin-left: -0.5rem;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .back-btn:active { background: #f3f4f6; }
    
    .header-title {
      font-weight: 600;
      font-size: 1rem;
    }
    
    /* Home View */
    .home-header {
      padding: 1.5rem 1.25rem 0.5rem;
    }
    
    .home-header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }
    
    .home-header p {
      color: #6b7280;
      font-size: 0.875rem;
    }
    
    /* State Cards */
    .states-grid {
      padding: 1rem 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .state-card {
      width: 100%;
      padding: 1rem;
      border-radius: 1rem;
      border: 2px solid;
      text-align: left;
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.2s;
      background: white;
    }
    
    .state-card:active { transform: scale(0.98); }
    
    .state-card-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }
    
    .state-icon {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .state-icon svg {
      width: 1.25rem;
      height: 1.25rem;
      color: white;
    }
    
    .state-label {
      font-weight: 600;
      font-size: 1rem;
    }
    
    .state-desc {
      font-size: 0.875rem;
      color: #6b7280;
    }
    
    /* State Colors */
    .state-understimulated .state-card { background: #fffbeb; border-color: #fde68a; }
    .state-understimulated .state-icon { background: #f59e0b; }
    .state-understimulated .state-label { color: #b45309; }
    
    .state-overwhelmed .state-card { background: #f8fafc; border-color: #e2e8f0; }
    .state-overwhelmed .state-icon { background: #64748b; }
    .state-overwhelmed .state-label { color: #475569; }
    
    .state-hyperactivated .state-card { background: #fff1f2; border-color: #fecdd3; }
    .state-hyperactivated .state-icon { background: #f43f5e; }
    .state-hyperactivated .state-label { color: #be123c; }
    
    .state-regulated .state-card { background: #ecfdf5; border-color: #a7f3d0; }
    .state-regulated .state-icon { background: #10b981; }
    .state-regulated .state-label { color: #047857; }
    
    /* Sections Grid */
    .sections-header {
      padding: 1rem 1.25rem 0.75rem;
      font-size: 1.125rem;
      font-weight: 600;
    }
    
    .sections-grid {
      padding: 0 1.25rem;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }
    
    .section-btn {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      background: white;
      border: 1px solid #f3f4f6;
      border-radius: 0.75rem;
      cursor: pointer;
      text-align: left;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .section-btn:active { background: #f9fafb; }
    
    .section-btn svg {
      width: 1.25rem;
      height: 1.25rem;
      color: #9ca3af;
    }
    
    .section-btn span {
      font-weight: 500;
      color: #374151;
      font-size: 0.9rem;
    }
    
    /* Quote */
    .quote-card {
      margin: 1.5rem 1.25rem;
      padding: 1.25rem;
      background: linear-gradient(135deg, #1f2937, #111827);
      border-radius: 1rem;
      color: white;
    }
    
    .quote-card p {
      font-size: 0.9rem;
      opacity: 0.9;
      font-style: italic;
      line-height: 1.6;
    }
    
    .quote-card .author {
      font-size: 0.75rem;
      opacity: 0.6;
      margin-top: 0.5rem;
      font-style: normal;
    }
    
    /* Interventions View */
    .need-card {
      margin: 1.25rem;
      padding: 1rem;
      border-radius: 1rem;
      border: 1px solid;
    }
    
    .need-card .label {
      font-size: 0.875rem;
      font-weight: 500;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }
    
    .need-card .text {
      font-weight: 500;
    }
    
    .interventions-list {
      padding: 0 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .intervention-card {
      background: white;
      border-radius: 0.75rem;
      border: 1px solid #f3f4f6;
      overflow: hidden;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .intervention-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      cursor: pointer;
    }
    
    .intervention-number {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.875rem;
      font-weight: 500;
      flex-shrink: 0;
    }
    
    .intervention-title {
      font-weight: 500;
      flex: 1;
    }
    
    .intervention-detail {
      padding: 0 1rem 1rem 3.75rem;
      font-size: 0.875rem;
      color: #6b7280;
      line-height: 1.6;
      display: none;
    }
    
    .intervention-card.expanded .intervention-detail { display: block; }
    
    .chevron {
      transition: transform 0.2s;
    }
    
    .intervention-card.expanded .chevron {
      transform: rotate(180deg);
    }
    
    .check-again-btn {
      margin: 1.5rem 1.25rem;
      width: calc(100% - 2.5rem);
      padding: 0.875rem;
      background: #f3f4f6;
      border: none;
      border-radius: 0.75rem;
      font-weight: 500;
      color: #374151;
      cursor: pointer;
      font-size: 1rem;
    }
    
    .check-again-btn:active { background: #e5e7eb; }
    
    /* Section View */
    .section-content {
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    
    .content-group {
      background: white;
      border-radius: 0.75rem;
      border: 1px solid #f3f4f6;
      overflow: hidden;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .content-group-title {
      font-weight: 600;
      padding: 1rem;
      background: #f9fafb;
      border-bottom: 1px solid #f3f4f6;
      font-size: 0.95rem;
    }
    
    .content-item {
      border-bottom: 1px solid #f3f4f6;
      cursor: pointer;
    }
    
    .content-item:last-child { border-bottom: none; }
    
    .content-item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.875rem 1rem;
    }
    
    .content-item-heading {
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    .content-item-text {
      padding: 0 1rem 0.875rem;
      font-size: 0.875rem;
      color: #6b7280;
      line-height: 1.6;
      display: none;
    }
    
    .content-item.expanded .content-item-text { display: block; }
    .content-item.expanded .chevron { transform: rotate(180deg); }
    
    /* Utilities */
    .hidden { display: none !important; }
    
    /* Safe area for notched phones */
    @supports (padding-top: env(safe-area-inset-top)) {
      .header { padding-top: env(safe-area-inset-top); }
      body { padding-bottom: env(safe-area-inset-bottom); }
    }
  </style>
</head>
<body>
  <div class="container" id="app"></div>

  <script>
    // Icons as SVG strings
    const icons = {
      arrowLeft: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>',
      chevronDown: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>',
      brain: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>',
      zap: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>',
      cloudOff: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 2l20 20M5 5a7 7 0 0 0 2.8 11.2M8.8 8.8a4 4 0 0 0 .9 7.2h6.6M19.1 19.1A7 7 0 0 0 18 5a5 5 0 0 0-9-1"/></svg>',
      check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',
      clock: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
      heart: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>',
      users: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
      briefcase: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>',
      sun: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>'
    };

    // Data
    const states = {
      understimulated: {
        id: 'understimulated',
        label: 'Understimulated',
        description: "Bored, restless, seeking, can't settle",
        icon: 'cloudOff',
        need: 'Stimulation — movement, novelty, engagement',
        interventions: [
          { title: 'Add stimulation', detail: 'Music, background noise, coffee shop sounds. Your brain needs MORE input to focus, not less.' },
          { title: 'Shrink the task', detail: 'Not "do the thing" — "open the document and write one sentence." Make starting trivial.' },
          { title: 'Body double', detail: 'Work alongside someone, even virtually. Borrow structure from outside yourself.' },
          { title: 'Change environment', detail: 'Different room, different chair, go outside. Novelty activates attention.' },
          { title: 'Movement first', detail: '5 minutes of physical activity. Walk, stretch, shake. Then try again.' }
        ]
      },
      overwhelmed: {
        id: 'overwhelmed',
        label: 'Overwhelmed',
        description: "Paralysed, shutdown, foggy, can't start",
        icon: 'brain',
        need: 'Discharge — physical release, then containment',
        interventions: [
          { title: 'Physical discharge first', detail: "Cold water on face, intense movement, shake it out. Your body needs to release before your mind can work." },
          { title: 'Reduce inputs', detail: "Close tabs, silence notifications, find quiet. You're overloaded — remove stimulation." },
          { title: 'One thing only', detail: "What's the ONE thing with actual consequences? Do only that. Everything else waits." },
          { title: 'Lower the bar', detail: '"Good enough" is the goal. Excellence is not available right now, and that\'s fine.' },
          { title: 'Tell someone', detail: 'Isolation amplifies the spiral. One text to one person: "I\'m struggling today."' }
        ]
      },
      hyperactivated: {
        id: 'hyperactivated',
        label: 'Hyperactivated',
        description: "Racing, anxious, can't stop, mind spinning",
        icon: 'zap',
        need: 'Grounding — slow breath, body awareness, boundaries',
        interventions: [
          { title: 'Extended exhale breathing', detail: 'Breathe in for 4, out for 8. The long exhale activates your parasympathetic system.' },
          { title: 'Physical grounding', detail: 'Feet on floor. Name 5 things you can see. Feel your hands. Come back to your body.' },
          { title: 'Time anchor', detail: 'Say out loud: "It\'s [time]. I have [X hours] until [next thing]." Time becomes real when spoken.' },
          { title: 'Reality check', detail: "Ask: \"What's actually urgent right now?\" Usually nothing. The urgency is internal, not real." },
          { title: 'Boundaries', detail: "You're allowed to stop. You're allowed to say no. You're allowed to do less." }
        ]
      },
      regulated: {
        id: 'regulated',
        label: 'Regulated',
        description: 'Present, capable, engaged but not frantic',
        icon: 'check',
        need: "Maintenance — don't blow it with overcommitment",
        interventions: [
          { title: 'Use this window wisely', detail: 'This is your deep work time. Complex decisions, creative work, hard conversations — do them now.' },
          { title: "Don't overcommit", detail: "Feeling capable ≠ being capable of everything. Protect this state by not overloading it." },
          { title: 'Note what got you here', detail: 'What did you do today that helped? Sleep, movement, food, environment? Remember it.' },
          { title: 'Batch the hard stuff', detail: 'Admin, emails, difficult tasks — knock them out while you have capacity.' },
          { title: 'Schedule rest', detail: "You'll crash eventually. Plan for it rather than being surprised by it." }
        ]
      }
    };

    const sections = {
      tasks: {
        id: 'tasks',
        label: 'Tasks',
        icon: 'clock',
        content: [
          {
            title: 'Starting (The Hardest Part)',
            items: [
              { heading: 'Shrink the commitment', text: 'Not "write the report" — "open the document and write one sentence." Your brain rebels against large commitments. Make starting trivial.' },
              { heading: 'Implementation intentions', text: '"When I finish lunch, I will immediately open the spreadsheet." Linking new behaviour to existing triggers bypasses decision fatigue.' },
              { heading: 'Externalise motivation', text: 'Accountability partners, public commitments, coworking. Internal motivation is unreliable; borrow structure from outside.' }
            ]
          },
          {
            title: 'Sustaining Focus',
            items: [
              { heading: 'Timeboxing', text: 'Work in defined blocks: 25 or 45 minutes. Open-ended sessions are focus death. Containers create urgency.' },
              { heading: 'The "boring" workaround', text: "Can you make it novel? Gamify it? Add stakes? You're not lazy — you're understimulated." },
              { heading: 'One tab, one task', text: "Close everything except what you're working on. Every open option is a leak in your attention." }
            ]
          },
          {
            title: 'Finishing',
            items: [
              { heading: 'Define "done" before starting', text: 'Not "work on presentation" — "complete slides 1-5 with speaker notes." Ambiguous endpoints make completion impossible.' },
              { heading: 'Completion rituals', text: 'Physical act to mark finishing: close the laptop, stand up, say "done" out loud. Your brain needs clear signals.' },
              { heading: 'The 90% trap', text: 'ADD brains often stop at "basically done." Build in a final review step. The last 10% is where things fall apart.' }
            ]
          }
        ]
      },
      emotions: {
        id: 'emotions',
        label: 'Emotions',
        icon: 'heart',
        content: [
          {
            title: 'The ADD Emotional Pattern',
            items: [
              { heading: 'Fast and intense', text: "Feelings arrive quickly and hit hard. This isn't weakness — it's part of the same dysregulation that affects attention." },
              { heading: 'Rejection sensitivity', text: "Criticism lands disproportionately. You're not overreacting — your nervous system processes it differently." },
              { heading: 'Rumination loops', text: 'Difficulty letting things go. The same thought circling. This is attention dysregulation applied to emotions.' }
            ]
          },
          {
            title: 'Working With It',
            items: [
              { heading: "The feeling isn't the problem", text: 'The avoidance is. Most ADD coping (distraction, busyness) is avoiding feelings. The scatteredness often IS the avoidance.' },
              { heading: 'Tolerate before you regulate', text: 'When a difficult feeling arises, pause. Don\'t fix or distract. Just notice: "I feel anxious." Stay with it for 30 seconds.' },
              { heading: 'Separate feeling from story', text: '"I feel rejected" is a feeling. "They think I\'m incompetent" is a story. You can have the feeling without believing the story.' }
            ]
          },
          {
            title: 'On Shame',
            items: [
              { heading: "It's not earned", text: 'The shame of "I should be able to do this" is inherited, not deserved. You adapted to circumstances.' },
              { heading: 'Address it directly', text: 'Unexamined shame runs your life. Name it. Look at it. Ask: where did this come from?' }
            ]
          }
        ]
      },
      relationships: {
        id: 'relationships',
        label: 'Relationships',
        icon: 'users',
        content: [
          {
            title: 'Common Patterns',
            items: [
              { heading: 'Interrupting', text: 'Impulse control failure. Try: physical anchor — hold an object, press fingers together when the urge arises.' },
              { heading: 'Forgetting commitments', text: 'Time blindness + out of sight = out of mind. Use shared calendars, immediate capture, repeat back what was agreed.' },
              { heading: 'Emotional reactivity', text: 'Feels like overreaction to others. Try: "Let me think about that and come back to you." Build in time delays.' },
              { heading: 'Inconsistent presence', text: 'Hyperfocus elsewhere. Schedule protected time for relationships. Devices physically away.' }
            ]
          },
          {
            title: 'How to Explain It',
            items: [
              { heading: 'A script that works', text: '"My brain works differently in ways that affect [specific behaviour]. It\'s not that I don\'t care. Here\'s what I\'m doing to manage it: [strategy]. Here\'s what would help from you: [request]."' },
              { heading: "Don't over-apologise", text: "Don't use ADD as an excuse. Do be specific and solutions-oriented. Take responsibility without taking blame." }
            ]
          }
        ]
      },
      work: {
        id: 'work',
        label: 'Work',
        icon: 'briefcase',
        content: [
          {
            title: 'Meeting Your Limitations',
            items: [
              { heading: 'Time estimation is broken', text: 'Build in buffers. Never promise tight turnarounds. Add 50% to every estimate as default.' },
              { heading: 'Sustained admin is impossible', text: "Batch it, outsource it, or automate it. Don't pretend you'll do it consistently." },
              { heading: 'Open-plan destroys you', text: 'Noise-cancelling headphones, remote work when possible, find private space.' },
              { heading: 'Email becomes a graveyard', text: 'Time-blocked processing (twice daily), not reactive checking.' }
            ]
          },
          {
            title: 'Playing to Strengths',
            items: [
              { heading: 'Crisis response', text: "High stimulation = engagement. You're good in emergencies." },
              { heading: 'Novel problem-solving', text: 'You see connections others miss. Non-linear thinking is an asset.' },
              { heading: 'Hyperfocus bursts', text: 'When aligned with interest, you can outwork anyone. Unsustainable but powerful.' },
              { heading: 'Stop trying to be consistent', text: "You're not going to become a steady plodder. Design your role around what you're actually good at." }
            ]
          },
          {
            title: 'Energy Management',
            items: [
              { heading: 'Your capacity is variable', text: "Not constant. Track when you're sharp, when you crash. Build your schedule around this." },
              { heading: 'High-energy windows', text: 'Deep work, complex decisions, creative work. Protect these times aggressively.' },
              { heading: 'Low-energy windows', text: "Admin, email, routine tasks. Don't waste good hours on these." }
            ]
          }
        ]
      },
      routines: {
        id: 'routines',
        label: 'Routines',
        icon: 'sun',
        content: [
          {
            title: 'Morning Non-Negotiables',
            items: [
              { heading: 'No phone first 30-60 mins', text: "Protect your attentional state before it's hijacked. This is the highest-leverage habit." },
              { heading: 'Physical activation', text: 'Movement wakes up the prefrontal cortex. Even 10 minutes.' },
              { heading: 'Review the day', text: 'What are the 1-3 things that actually matter today? Not a list. Priorities.' },
              { heading: 'Eat protein', text: 'Stabilises blood sugar, supports dopamine production. Not optional.' }
            ]
          },
          {
            title: 'Evening Wind-Down',
            items: [
              { heading: 'Hard stop on work', text: 'Defined time, not "when I\'m done." You\'ll never feel done.' },
              { heading: 'Brain dump', text: 'Write down anything still spinning. Get it out of your head and onto paper.' },
              { heading: 'Reduce stimulation', text: 'Screens down, lights low. Your nervous system needs the signal.' },
              { heading: 'Same sleep time', text: 'Irregular sleep worsens everything. Protect this ruthlessly.' }
            ]
          },
          {
            title: 'Weekly Rhythm',
            items: [
              { heading: 'Weekly review', text: "What worked? What didn't? Adjust systems. 30 minutes, same time each week." },
              { heading: 'Plan the week', text: 'Not a detailed schedule. Key priorities identified. Buffer space left.' },
              { heading: 'One "off" period', text: 'Time with no obligations, no productivity pressure. This is not optional.' }
            ]
          }
        ]
      }
    };

    // App State
    let currentView = 'home';
    let selectedState = null;
    let selectedSection = null;

    // Render functions
    function render() {
      const app = document.getElementById('app');
      
      if (currentView === 'home') {
        app.innerHTML = renderHome();
      } else if (currentView === 'interventions') {
        app.innerHTML = renderInterventions();
      } else if (currentView === 'section') {
        app.innerHTML = renderSection();
      }
      
      attachEventListeners();
    }

    function renderHome() {
      return `
        <div class="header"></div>
        <div class="home-header">
          <h1>How are you right now?</h1>
          <p>Recognise your state, then work with it.</p>
        </div>
        <div class="states-grid">
          ${Object.values(states).map(state => `
            <div class="state-${state.id}" data-state="${state.id}">
              <div class="state-card">
                <div class="state-card-header">
                  <div class="state-icon">${icons[state.icon]}</div>
                  <span class="state-label">${state.label}</span>
                </div>
                <p class="state-desc">${state.description}</p>
              </div>
            </div>
          `).join('')}
        </div>
        <h2 class="sections-header">Go deeper</h2>
        <div class="sections-grid">
          ${Object.values(sections).map(section => `
            <button class="section-btn" data-section="${section.id}">
              ${icons[section.icon]}
              <span>${section.label}</span>
            </button>
          `).join('')}
        </div>
        <div class="quote-card">
          <p>"The greatest gift you can give yourself is to understand yourself without judgment."</p>
          <p class="author">— Gabor Maté</p>
        </div>
      `;
    }

    function renderInterventions() {
      const state = states[selectedState];
      const colorClasses = {
        understimulated: { bg: '#fffbeb', border: '#fde68a', text: '#b45309', accent: '#f59e0b' },
        overwhelmed: { bg: '#f8fafc', border: '#e2e8f0', text: '#475569', accent: '#64748b' },
        hyperactivated: { bg: '#fff1f2', border: '#fecdd3', text: '#be123c', accent: '#f43f5e' },
        regulated: { bg: '#ecfdf5', border: '#a7f3d0', text: '#047857', accent: '#10b981' }
      };
      const colors = colorClasses[selectedState];
      
      return `
        <div class="header visible">
          <div class="header-inner">
            <button class="back-btn" data-action="home">${icons.arrowLeft}</button>
            <h1 class="header-title">${state.label}</h1>
          </div>
        </div>
        <div class="need-card" style="background: ${colors.bg}; border-color: ${colors.border};">
          <p class="label">What you need:</p>
          <p class="text" style="color: ${colors.text};">${state.need}</p>
        </div>
        <div class="interventions-list">
          ${state.interventions.map((intervention, i) => `
            <div class="intervention-card ${i === 0 ? 'expanded' : ''}" data-intervention="${i}">
              <div class="intervention-header">
                <div class="intervention-number" style="background: ${colors.accent};">${i + 1}</div>
                <span class="intervention-title">${intervention.title}</span>
                <span class="chevron">${icons.chevronDown}</span>
              </div>
              <div class="intervention-detail">${intervention.detail}</div>
            </div>
          `).join('')}
        </div>
        <button class="check-again-btn" data-action="home">Check in again</button>
      `;
    }

    function renderSection() {
      const section = sections[selectedSection];
      
      return `
        <div class="header visible">
          <div class="header-inner">
            <button class="back-btn" data-action="home">${icons.arrowLeft}</button>
            <h1 class="header-title">${section.label}</h1>
          </div>
        </div>
        <div class="section-content">
          ${section.content.map(group => `
            <div class="content-group">
              <h3 class="content-group-title">${group.title}</h3>
              ${group.items.map((item, i) => `
                <div class="content-item" data-item="${i}">
                  <div class="content-item-header">
                    <span class="content-item-heading">${item.heading}</span>
                    <span class="chevron">${icons.chevronDown}</span>
                  </div>
                  <div class="content-item-text">${item.text}</div>
                </div>
              `).join('')}
            </div>
          `).join('')}
        </div>
      `;
    }

    function attachEventListeners() {
      // State cards
      document.querySelectorAll('[data-state]').forEach(el => {
        el.addEventListener('click', () => {
          selectedState = el.dataset.state;
          currentView = 'interventions';
          render();
        });
      });
      
      // Section buttons
      document.querySelectorAll('[data-section]').forEach(el => {
        el.addEventListener('click', () => {
          selectedSection = el.dataset.section;
          currentView = 'section';
          render();
        });
      });
      
      // Back / Home buttons
      document.querySelectorAll('[data-action="home"]').forEach(el => {
        el.addEventListener('click', () => {
          currentView = 'home';
          selectedState = null;
          selectedSection = null;
          render();
        });
      });
      
      // Intervention cards
      document.querySelectorAll('[data-intervention]').forEach(el => {
        el.querySelector('.intervention-header').addEventListener('click', () => {
          el.classList.toggle('expanded');
        });
      });
      
      // Content items
      document.querySelectorAll('.content-item').forEach(el => {
        el.addEventListener('click', () => {
          el.classList.toggle('expanded');
        });
      });
    }

    // Service Worker for offline support
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('data:text/javascript,' + encodeURIComponent(`
        self.addEventListener('install', e => self.skipWaiting());
        self.addEventListener('activate', e => e.waitUntil(clients.claim()));
        self.addEventListener('fetch', e => {
          e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
        });
      `)).catch(() => {});
    }

    // Initial render
    render();
  </script>
</body>
</html>
